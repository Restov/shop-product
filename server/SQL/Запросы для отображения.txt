Страница с разделами каталога
SELECT c.id,c.name,c.description, COUNT(*) AS product_count
FROM (SELECT * FROM product_categories
UNION
SELECT * FROM product_main_categories ) as cats
INNER JOIN categories as c ON c.id = cats.category_id
INNER JOIN products as p ON cats.product_id = p.id
WHERE p.quantity > 0
GROUP BY cats.category_id
ORDER BY product_count DESC;


Вернёт все разделы в порядке убывания товаров (без пустых разделов)


5b. SELECT categories.id,categories.name,categories.description, COUNT(*) AS product_count
FROM (SELECT * FROM product_categories 
UNION
SELECT * FROM product_main_categories) as cats
INNER JOIN categories ON categories.id = cats.category_id
INNER JOIN products ON cats.product_id = products.id
WHERE products.quantity > 0
GROUP BY cats.category_id
HAVING product_count >=2 
ORDER BY product_count DESC;

Клик на раздел
Данные по разделу - SELECT name,description FROM categories WHERE id = :id;

Вывод всех карточек 

SELECT p.id,p.title,c.name as main_cat, i.ref,i.alt FROM (SELECT * FROM product_categories as pc UNION SELECT * FROM product_main_categories as pmc) as z
INNER JOIN products as p on z.product_id = p.id
INNER JOIN product_main_categories as pmc ON pmc.product_id = z.product_id
INNER JOIN categories as c ON pmc.category_id = c.id
INNER JOIN product_main_images as pmi ON pmi.product_id = p.id
INNER JOIN images as i ON pmi.image_id = i.id
WHERE z.category_id = $id AND p.quantity > 0 LIMIT 12 OFFSET $offset ($offset = $page * 12)

Карточка товара
SELECT title, price, price_no_discount, price_promo, description
FROM products
WHERE id = $id;

Все категории товара в карточке
"SELECT DISTINCT c.id, c.name
FROM (SELECT * FROM product_categories UNION SELECT * FROM product_main_categories) as z
INNER JOIN categories as c ON c.id = z.category_id
WHERE product_id = $id;";

Все картинки товара в карточке
SELECT i.ref,i.alt 
FROM (SELECT * FROM product_images 
UNION
SELECT * FROM product_main_images) as z
INNER JOIN images as i ON i.id = z.image_id
WHERE product_id =$id;

Главная картинка товара
SELECT i.ref,i.alt FROM images as i INNER JOIN product_main_images as pmc ON i.id = pmc.image_id WHERE pmc.product_id = $id;

Главная категория для кнопки назад
SELECT c.name AS main_cat, c.id AS main_cat_id
        FROM product_main_categories as pmc
        INNER JOIN categories as c ON pmc.category_id = c.id
        WHERE pmc.product_id = $id;